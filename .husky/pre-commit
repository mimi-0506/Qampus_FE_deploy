#!/bin/sh

echo "ğŸ”¹ Husky pre-commit hook started..."

# ë³€ê²½ëœ íŒŒì¼ ëª©ë¡ ê°€ì ¸ì˜¤ê¸°
FILES=$(git diff --cached --name-only --diff-filter=ACMR | sed 's| |\\ |g')
[ -z "$FILES" ] && exit 0

# Prettier ì ìš©
export PATH=$PATH:/usr/local/bin  # Mac/Linux
export PATH=$PATH:$HOME/.nvm/versions/node/$(nvm version)/bin  # nvm ì‚¬ìš©ì

echo "ğŸ”¹ Formatting files with Prettier..."
echo "$FILES" | xargs ./node_modules/.bin/prettier --ignore-unknown --write

# Lint-Staged ì‹¤í–‰
echo "ğŸ”¹ Running lint-staged..."
if npx lint-staged; then
  echo "âœ… All lint rules passed successfully!"
  exit 0
else
  echo "âŒ Lint errors detected! Commit aborted."
  
  # ë¦°íŠ¸ ì˜¤ë¥˜ê°€ ë°œìƒí•œ íŒŒì¼ ëª©ë¡ ì¶œë ¥
  echo "ğŸ”¹ Files that caused linting errors:"
  git diff --cached --name-only --diff-filter=ACMR
fi
